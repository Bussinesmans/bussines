// üî• –í–°–¢–ê–í–¨ –°–í–û–ô URL –°–Æ–î–ê
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyGAwyQNRHJRJCeXApgB_PcYnKAit4Jrs4HD293LIhMQzQj0UxK3natnXWVJFpuH4os/exec';

async function analyzeAccount() {
    const username = document.getElementById('username').value.trim();
    const analyzeBtn = document.getElementById('analyzeBtn');
    const loading = document.getElementById('loading');
    const results = document.getElementById('results');

    if (!username) {
        showMessage('–í–≤–µ–¥–∏—Ç–µ username Instagram', 'error');
        return;
    }

    analyzeBtn.disabled = true;
    loading.style.display = 'block';
    results.innerHTML = '';

    try {
        const response = await fetch(`${GOOGLE_SCRIPT_URL}?username=${encodeURIComponent(username)}`);
        const data = await response.json();
        
        if (data.success) {
            displayResults(data);
        } else {
            showMessage(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞', 'error');
        }
    } catch (error) {
        showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
    }

    analyzeBtn.disabled = false;
    loading.style.display = 'none';
}

function displayResults(data) {
    const results = document.getElementById('results');
    
    let html = `
        <div class="stats">
            <h2>üìä @${data.username}</h2>
            <p><strong>${data.full_name || ''}</strong></p>
            <div style="display: flex; gap: 20px; margin-top: 10px; flex-wrap: wrap;">
                <span>üë• ${data.followers?.toLocaleString() || 'N/A'} –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</span>
                <span>üìù ${data.posts_count || 'N/A'} –ø–æ—Å—Ç–æ–≤</span>
                <span>üïí ${data.analyzed_at}</span>
            </div>
        </div>
    `;
    
    // –¢–æ–ø –ø–æ—Å—Ç–æ–≤
    html += `<div class="section"><h3 class="section-title">üéØ –¢–û–ü-5 –ü–û–°–¢–û–í –ü–û –õ–ê–ô–ö–ê–ú</h3>`;
    
    if (data.top_posts && data.top_posts.length > 0) {
        data.top_posts.forEach((post, index) => {
            const postType = post.is_video ? 'üé¨ REELS' : 'üì∑ –§–æ—Ç–æ';
            html += `
                <div class="post-card">
                    <strong>#${index + 1} | ${postType} | ‚ù§Ô∏è ${post.likes?.toLocaleString() || 0} –ª–∞–π–∫–æ–≤ | üí¨ ${post.comments || 0} –∫–æ–º–º–µ–Ω—Ç–æ–≤</strong>
                    ${post.caption ? `<p style="margin-top: 8px; color: #555;">${post.caption}</p>` : ''}
                    <small>üìÖ ${post.date}</small>
                </div>
            `;
        });
    } else {
        html += `<p>–ü–æ—Å—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>`;
    }
    html += `</div>`;
    
    // –•–µ—à—Ç–µ–≥–∏
    html += `<div class="section"><h3 class="section-title">üè∑Ô∏è –ü–û–ü–£–õ–Ø–†–ù–´–ï –•–ï–®–¢–ï–ì–ò</h3>`;
    html += `<div class="hashtag-list">`;
    
    if (data.popular_hashtags && data.popular_hashtags.length > 0) {
        data.popular_hashtags.forEach(tag => {
            html += `<span class="hashtag">${tag}</span>`;
        });
    } else {
        html += `<p>–•–µ—à—Ç–µ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>`;
    }
    html += `</div></div>`;
    
    results.innerHTML = html;
}

function showMessage(message, type) {
    const results = document.getElementById('results');
    results.innerHTML = `<div class="${type}">${message}</div>`;
}

// –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –ø–æ Enter
document.getElementById('username').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') analyzeAccount();
});

// –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.onload = function() {
    const results = document.getElementById('results');
    results.innerHTML = `
        <div style="background: #e3f2fd; padding: 20px; border-radius: 10px;">
            <h3>üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</h3>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li>–í–≤–µ–¥–∏—Ç–µ username Instagram (–Ω–∞–ø—Ä–∏–º–µ—Ä: instagram, natgeo)</li>
                <li>–ù–∞–∂–º–∏—Ç–µ "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å"</li>
                <li>–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–ø –ø–æ—Å—Ç–æ–≤ –∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ö–µ—à—Ç–µ–≥–∏</li>
            </ol>
            <p><strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ø—É–±–ª–∏—á–Ω—ã–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏</p>
        </div>
    `;
}
