<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstaParser - –ê–Ω–∞–ª–∏–∑ Instagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .analyzer-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            margin-top: 30px;
        }

        .section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .stats {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .post-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .hashtag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .hashtag {
            background: #e9ecef;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ffebee;
            padding: 20px;
            border-radius: 10px;
            color: #c53030;
            margin-top: 20px;
        }

        .info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .insight-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç InstaParser</h1>
            <p>–ê–Ω–∞–ª–∏–∑ Instagram –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>

        <div class="analyzer-card">
            <div class="input-group">
                <input type="text" id="username" placeholder="–í–≤–µ–¥–∏—Ç–µ Instagram username (–±–µ–∑ @)" value="instagram">
                <button onclick="analyzeAccount()" id="analyzeBtn">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>–ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Instagram...</p>
            </div>

            <div class="results" id="results">
                <div class="info">
                    <h3>üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</h3>
                    <ol style="margin: 10px 0; padding-left: 20px;">
                        <li>–í–≤–µ–¥–∏—Ç–µ username Instagram (–Ω–∞–ø—Ä–∏–º–µ—Ä: instagram, natgeo)</li>
                        <li>–ù–∞–∂–º–∏—Ç–µ "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å"</li>
                        <li>–ü–æ–ª—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∞–∫–∫–∞—É–Ω—Ç–∞</li>
                    </ol>
                    <p><strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ø—É–±–ª–∏—á–Ω—ã–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // üî• –¢–í–û–ô GOOGLE SCRIPT URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyGAwyQNRHJRJCeXApgB_PcYnKAit4Jrs4HD293LIhMQzQj0UxK3natnXWVJFpuH4os/exec';

        async function analyzeAccount() {
            const username = document.getElementById('username').value.trim();
            const analyzeBtn = document.getElementById('analyzeBtn');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');

            if (!username) {
                showMessage('–í–≤–µ–¥–∏—Ç–µ username Instagram', 'error');
                return;
            }

            analyzeBtn.disabled = true;
            loading.style.display = 'block';
            results.innerHTML = '';

            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?username=${encodeURIComponent(username)}`);
                const data = await response.json();
                
                if (data.success) {
                    displayResults(data);
                } else {
                    showMessage(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞', 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
            }

            analyzeBtn.disabled = false;
            loading.style.display = 'none';
        }

        function displayResults(data) {
            const results = document.getElementById('results');
            
            // –†–∞—Å—á–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            const videoPercentage = calculateVideoPercentage(data.top_posts);
            const photoPercentage = calculatePhotoPercentage(data.top_posts);
            const avgLikes = calculateAvgLikes(data.top_posts);
            const engagementRate = calculateEngagementRate(data);
            const bestContentType = getBestContentType(data.top_posts);
            const topHashtags = getTopHashtags(data.popular_hashtags);
            
            let html = `
                <div class="stats">
                    <h2>üìä @${data.username}</h2>
                    <p><strong>${data.full_name || ''}</strong></p>
                    <div style="display: flex; gap: 20px; margin-top: 10px; flex-wrap: wrap;">
                        <span>üë• ${data.followers?.toLocaleString() || 'N/A'} –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</span>
                        <span>üìù ${data.posts_count || 'N/A'} –ø–æ—Å—Ç–æ–≤</span>
                        <span>üïí ${data.analyzed_at}</span>
                    </div>
                </div>
            `;
            
            // üî• –ö–õ–Æ–ß–ï–í–´–ï –ò–ù–°–ê–ô–¢–´
            html += `
                <div class="section">
                    <h3 class="section-title">üíé –ö–õ–Æ–ß–ï–í–´–ï –ò–ù–°–ê–ô–¢–´</h3>
                    
                    <div class="insight-card">
                        <strong>üéØ –§–æ—Ä–º—É–ª–∞ —É—Å–ø–µ—Ö–∞:</strong>
                        <p>–ê–∫–∫–∞—É–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ${videoPercentage}% –≤–∏–¥–µ–æ –∏ ${photoPercentage}% —Ñ–æ—Ç–æ –≤ —Ç–æ–ø-–ø–æ—Å—Ç–∞—Ö</p>
                    </div>
                    
                    <div class="insight-card">
                        <strong>üìà –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞:</strong>
                        <p>–°—Ä–µ–¥–Ω–∏–µ –ª–∞–π–∫–∏: ${avgLikes} | –í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å: ${engagementRate}%</p>
                    </div>
                    
                    <div class="insight-card">
                        <strong>üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong>
                        <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –±–æ–ª—å—à–µ ${bestContentType} –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞</p>
                    </div>
                </div>
            `;
            
            // üî• –î–ï–¢–ê–õ–¨–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê
            html += `
                <div class="section">
                    <h3 class="section-title">üìä –î–ï–¢–ê–õ–¨–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê</h3>
                    <div class="post-card">
                        <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>üé¨ –í–∏–¥–µ–æ/Reels: ${videoPercentage}% —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤</li>
                            <li>üì∑ –§–æ—Ç–æ: ${photoPercentage}% —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤</li>
                            <li>‚ù§Ô∏è –°—Ä–µ–¥–Ω–∏–µ –ª–∞–π–∫–∏: ${avgLikes} –Ω–∞ –ø–æ—Å—Ç</li>
                            <li>üìà –í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å: ${engagementRate}% (–ª–∞–π–∫–∏ + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)</li>
                            <li>‚≠ê –°–∞–º—ã–π —É—Å–ø–µ—à–Ω—ã–π —Ç–∏–ø: ${bestContentType}</li>
                        </ul>
                    </div>
                </div>
            `;
            
            // üî• –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò
            html += `
                <div class="section">
                    <h3 class="section-title">üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –†–û–°–¢–ê</h3>
                    <div class="post-card">
                        <strong>–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ ${data.top_posts?.length || 0} —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>‚úÖ –î–µ–ª–∞–π—Ç–µ –±–æ–ª—å—à–µ <strong>${bestContentType}</strong> –∫–æ–Ω—Ç–µ–Ω—Ç–∞</li>
                            <li>‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ö–µ—à—Ç–µ–≥–∏: <strong>${topHashtags}</strong></li>
                            <li>‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ–ø–∏—Å–∞–Ω–∏—è —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ –Ω–∏–∂–µ</li>
                            <li>‚úÖ –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å—Ç–∏–ª—å, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç</li>
                        </ul>
                    </div>
                </div>
            `;
            
            // –¢–û–ü –ü–û–°–¢–û–í
            html += `<div class="section"><h3 class="section-title">üéØ –¢–û–ü-${Math.min(5, data.top_posts?.length || 0)} –ü–û–°–¢–û–í –ü–û –õ–ê–ô–ö–ê–ú</h3>`;
            
            if (data.top_posts && data.top_posts.length > 0) {
                data.top_posts.forEach((post, index) => {
                    const postType = post.is_video ? 'üé¨ REELS' : 'üì∑ –§–æ—Ç–æ';
                    const engagement = calculatePostEngagement(post, data.followers);
                    
                    html += `
                        <div class="post-card">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                <strong>#${index + 1} | ${postType}</strong>
                                <span style="background: #667eea; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                                    ${engagement}% –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å
                                </span>
                            </div>
                            <div style="color: #666; font-size: 14px; margin-bottom: 8px;">
                                ‚ù§Ô∏è ${post.likes?.toLocaleString() || 0} –ª–∞–π–∫–æ–≤ | üí¨ ${post.comments || 0} –∫–æ–º–º–µ–Ω—Ç–æ–≤
                            </div>
                            ${post.caption ? `<p style="margin-top: 8px; color: #555; font-style: italic;">"${post.caption}"</p>` : ''}
                            <small style="color: #888;">üìÖ ${post.date}</small>
                        </div>
                    `;
                });
            } else {
                html += `<p>–ü–æ—Å—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>`;
            }
            html += `</div>`;
            
            // –•–ï–®–¢–ï–ì–ò
            html += `<div class="section"><h3 class="section-title">üè∑Ô∏è –ü–û–ü–£–õ–Ø–†–ù–´–ï –•–ï–®–¢–ï–ì–ò</h3>`;
            html += `<div class="hashtag-list">`;
            
            if (data.popular_hashtags && data.popular_hashtags.length > 0) {
                data.popular_hashtags.forEach(tag => {
                    html += `<span class="hashtag">${tag}</span>`;
                });
            } else {
                html += `<p>–•–µ—à—Ç–µ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –æ–ø–∏—Å–∞–Ω–∏—è—Ö</p>`;
            }
            html += `</div>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">
                    üí° –≠—Ç–∏ —Ö–µ—à—Ç–µ–≥–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Å–∞–º—ã—Ö —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ—Å—Ç–∞—Ö –∞–∫–∫–∞—É–Ω—Ç–∞
                </p>
            </div>`;
            
            results.innerHTML = html;
        }

        // üî• –§–£–ù–ö–¶–ò–ò –ê–ù–ê–õ–ò–¢–ò–ö–ò
        function calculateVideoPercentage(posts) {
            if (!posts || posts.length === 0) return 0;
            const videoPosts = posts.filter(post => post.is_video).length;
            return Math.round((videoPosts / posts.length) * 100);
        }

        function calculatePhotoPercentage(posts) {
            if (!posts || posts.length === 0) return 0;
            const photoPosts = posts.filter(post => !post.is_video).length;
            return Math.round((photoPosts / posts.length) * 100);
        }

        function calculateAvgLikes(posts) {
            if (!posts || posts.length === 0) return 0;
            const totalLikes = posts.reduce((sum, post) => sum + (post.likes || 0), 0);
            return Math.round(totalLikes / posts.length).toLocaleString();
        }

        function calculateEngagementRate(data) {
            if (!data.followers || data.followers === 0 || !data.top_posts) return '0';
            const totalEngagement = data.top_posts.reduce((sum, post) => sum + (post.likes || 0) + (post.comments || 0), 0);
            const avgEngagement = totalEngagement / data.top_posts.length;
            const engagementRate = (avgEngagement / data.followers) * 100;
            return engagementRate < 0.01 ? engagementRate.toFixed(3) : engagementRate.toFixed(2);
        }

        function calculatePostEngagement(post, followers) {
            if (!followers || followers === 0) return '0';
            const engagement = ((post.likes || 0) + (post.comments || 0)) / followers * 100;
            return engagement < 0.01 ? engagement.toFixed(3) : engagement.toFixed(2);
        }

        function getBestContentType(posts) {
            if (!posts || posts.length === 0) return '–∫–æ–Ω—Ç–µ–Ω—Ç–∞';
            const videoPosts = posts.filter(post => post.is_video);
            const photoPosts = posts.filter(post => !post.is_video);
            
            if (videoPosts.length === 0) return '—Ñ–æ—Ç–æ';
            if (photoPosts.length === 0) return '–≤–∏–¥–µ–æ';
            
            const avgVideoLikes = videoPosts.reduce((sum, post) => sum + (post.likes || 0), 0) / videoPosts.length;
            const avgPhotoLikes = photoPosts.reduce((sum, post) => sum + (post.likes || 0), 0) / photoPosts.length;
            
            return avgVideoLikes > avgPhotoLikes ? '–≤–∏–¥–µ–æ' : '—Ñ–æ—Ç–æ';
        }

        function getTopHashtags(hashtags) {
            if (!hashtags || hashtags.length === 0) return '–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∏–∂–µ';
            return hashtags.slice(0, 3).join(', ');
        }

        function showMessage(message, type) {
            const results = document.getElementById('results');
            results.innerHTML = `<div class="${type}">${message}</div>`;
        }

        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –ø–æ Enter
        document.getElementById('username').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') analyzeAccount();
        });
    </script>
</body>
</html>
